#git clone https://github.com/yigitpolat/Hyperledger-IoT
cd volume
kubectl create -f createPVandPVC.yaml

cd ../jobs
kubectl apply -f copyArtifactsJob.yaml
pod=$(kubectl get pods --selector=job-name=copyartifacts --output=jsonpath={.items..metadata.name})
kubectl cp ../artifacts $pod:/shared/
kubectl get pods -w

kubectl apply -f generateCryptoConfig.yaml
kubectl apply -f generateGenesisBlock.yaml
kubectl apply -f generateChanneltx.yaml
kubectl apply -f generateAnchorPeerMSPs.yaml

cd ../network-deployment
sh deployAll.sh

cd ../jobs
kubectl apply -f create_channel.yaml
kubectl apply -f join_channel.yaml
kubectl apply -f chaincode_install.yaml
kubectl apply -f chaincode_instantaite.yaml
kubectl apply -f updateAnchorPeers.yaml

cd ../API
docker build . -t cod3rdock3r/rest-api
docker push cod3rdock3r/rest-api

cd ..
kubectl create deployment rest-api --image=cod3rdock3r/rest-api
kubectl expose deployment rest-api --port=3000 --target-port=3000

kubectl apply -f node-red-svc-nodePort.yaml
